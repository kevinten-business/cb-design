# 一种Reactive反应式服务的改造思路

## Context

使用BIO模式调用IO接口，这种模式存在以下几个问题：

### 线程上下文切换开销：

一次请求的IO平均在1200ms，最高能达到50000ms，而计算时间只有1~2ms，理论上1C需要600~2500个线程。囤积如此多的线程将会造成大量的上下文切换开销。

但若是使用少量的线程，将可能由于线程数量的限制，导致请求量过高时拿不到处理线程，最终超时。

### 部署成本高：

若是采用主流的2C4G容器配置，理论上将需要1000+的线程用于处理请求，这将占用大概1GB的内存空间。

同时若并发请求数>线程数时，需要采用水平扩容增加服务的吞吐量，所以服务需要按照峰值并发进行预估部署，造成空闲时间大量资源的浪费。

服务如果部署2C8G*24台服务器，CPU利用率在峰值时约为25%

### 超时风险：

一次IO最高能达到50s，当有异常请求导致响应时间突增时，因为会阻塞线程，导致线程池中的线程大部分都被阻塞，从而无法响应新的请求。

在这种情况下，少量的异常请求将会导致上游大量的超时报错，因此服务不具有弹性。

---

面对传统BIO模式在IO密集型应用的缺点，随着Reactive反应式架构的流行，业界越来越多的开始采用Reactive架构来解决此类问题。

比如淘宝、高德等公司，开始推动服务的全异步升级。

---

## Goal

### 性能提升与成本缩减：

使用NIO方式发起IO的调用，避免线程阻塞，从而最大限度的消除上述缺点。

最终使得应用符合Reactive架构理念，从而具备弹性、容错性，以降低部署成本，提高资源利用率。

目标CPU利用率提升到50%，目标机器部署成本缩减一倍。

### Reactive小组建设：

在Reactive项目的技术改造中，将会涉及NIO、Netty、反应式编程等一系列比较深入或前沿的技术方向。

Reactive小组将通过举办Meetup的方式，对所涉及的知识进行交流分享，以使兴趣小组成员对该系列技术有较深的理解。

最后，小组成员将具备对同步服务的异步改造能力，从而推动更多项目的技术升级。

同时核心成员具备对RPC等框架改造PR的能力，为后续的更多项目提供知识储备。